<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2016-12-02 Fri 15:22 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="viewport" content="width=device-width, initial-scale=1" />
<title></title>
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="b" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center;
             margin-bottom: .2em; }
  .subtitle { text-align: center;
              font-size: medium;
              font-weight: bold;
              margin-top:0; }
  .todo   { font-family: monospace; color: red; }
  .done   { font-family: monospace; color: green; }
  .priority { font-family: monospace; color: orange; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .org-right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .org-left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .org-center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.org-right  { text-align: center;  }
  th.org-left   { text-align: center;   }
  th.org-center { text-align: center; }
  td.org-right  { text-align: right;  }
  td.org-left   { text-align: left;   }
  td.org-center { text-align: center; }
  dt { font-weight: bold; }
  .footpara { display: inline; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#orgheadline22">1. develop post-tonal contributions to getting started.org</a>
<ul>
<li><a href="#orgheadline19">1.1. building the dissonant piano player</a>
<ul>
<li><a href="#orgheadline4">1.1.1. testing out the piano</a></li>
<li><a href="#orgheadline7">1.1.2. load chord data and chord selection+transposition functions</a></li>
<li><a href="#orgheadline13">1.1.3. begin selecting chords according to probability distr</a></li>
<li><a href="#orgheadline17">1.1.4. choose the set type for dissonances</a></li>
<li><a href="#orgheadline18">1.1.5. tetrachord piano dissonances; hard-coded set-type</a></li>
</ul>
</li>
<li><a href="#orgheadline21">1.2. dealing with timing</a>
<ul>
<li><a href="#orgheadline20">1.2.1. making the dissonant piano player play in time</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#orgheadline27">2. reflection</a>
<ul>
<li><a href="#orgheadline23">2.1. This is the stable code for this page.</a></li>
<li><a href="#orgheadline24">2.2. experiment with different printing options</a></li>
<li><a href="#orgheadline26">2.3. improvements and refactoring</a>
<ul>
<li><a href="#orgheadline25">2.3.1. addendum</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="outline-container-orgheadline22" class="outline-2">
<h2 id="orgheadline22"><span class="section-number-2">1</span> develop post-tonal contributions to getting started.org</h2>
<div class="outline-text-2" id="text-1">
<p>
"Post-tonal" is not a familiar term outside of a small group of people
who are devoted to a particular swath of music of the (early)
twentieth century. Your typical introduction to computer music may
skirt the topic of explaining exactly what it is&#x2013;we'll largely follow
suit here for the moment.
</p>
</div>

<div id="outline-container-orgheadline19" class="outline-3">
<h3 id="orgheadline19"><span class="section-number-3">1.1</span> building the dissonant piano player</h3>
<div class="outline-text-3" id="text-1-1">
<p>
Let's start by working with a familiar sound, that of the acoustic
piano. We have access to an overtone library dedicated to working with
that sound. It's helpful to work with the piano because it will allow
us to elide questions about synthesizers and electronic music
production.
</p>
</div>

<div id="outline-container-orgheadline4" class="outline-4">
<h4 id="orgheadline4"><span class="section-number-4">1.1.1</span> testing out the piano</h4>
<div class="outline-text-4" id="text-1-1-1">
<p>
You will need access to the sampled-piano library provided by
overtone, which will take some time to download.
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline1"></a>build piano chord player<br  /><div class="outline-text-5" id="text-1-1-1-1">
<p>
Once you have the loaded the <code>sampled-piano</code> instrument you can use it
to play chords, which of course is a particular specialty of keyboard
instruments.
</p>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">play-piano-chord</span> [a-chord]
        (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [note a-chord] (sampled-piano note)))

(play-piano-chord [60 64 67])
</pre>
</div>
</div></li>

<li><a id="orgheadline3"></a>build quieter piano chord player with variable dynamics<br  /><div class="outline-text-5" id="text-1-1-1-2">
<p>
Note, by using rand-nth, we will be getting some (slightly arbitrary)
change in how loud chords are played. This suggests that probability
might start to be important. We will get to the question of automated
decision-making soon.
</p>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">play-quieter-piano-chord</span> [a-chord]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [level (rand-nth [0.2 0.4 0.6])]
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [note a-chord] (sampled-piano note <span style="color: #BFEBBF;">:level</span> level))))

(play-quieter-piano-chord [60 64 67])
</pre>
</div>

<p>
Here's we use an interesting functional programming idiom to generate
chord tones for the <code>play-quieter-piano-chord</code> function. 
</p>

<div class="org-src-container">

<pre class="src src-clojure">(play-quieter-piano-chord (map #(+ <span style="color: #DFAF8F;">%</span> 60) (repeatedly 4 (partial rand-int 12)))))
</pre>
</div>
</div>

<ol class="org-ol"><li><a id="orgheadline2"></a>load overtone algorithmic composition libraries<br  /><div class="outline-text-6" id="text-1-1-1-2-1">
<p>
Note that overtone itself has good support in its algorithmic library
for generating chords using chance procedures.
</p>

<div class="org-src-container">

<pre class="src src-clojure">(dir <span style="color: #7CB8BB;">overtone.algo.chance</span>)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(source <span style="color: #7CB8BB;">overtone.algo.chance</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>choose)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(source choose-n)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(source chosen-from)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(source only)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(source ranged-rand)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(source weighted-choose)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(source weighted-coin)
</pre>
</div>
</div></li></ol></li></ol>
</div>

<div id="outline-container-orgheadline7" class="outline-4">
<h4 id="orgheadline7"><span class="section-number-4">1.1.2</span> load chord data and chord selection+transposition functions</h4>
<div class="outline-text-4" id="text-1-1-2">
<p>
One term you will hear when studying post-tonal music is "set theory."
This term has a particular meaning in mathematics that is
not especially related to its use in music, so it is useful to
distinguish its usage here. The best way to do that is to think about
the organization of pitch elements of music using "integer notation."
Luckily, computer languages deal quite readily with integers. Let's
talk a look.
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline5"></a>load set data in the ./src/ directory<br  /><div class="outline-text-5" id="text-1-1-2-1">
<p>
The main contribution that I am providing here is a simple one that
anyone could provide: access to a bunch of sets of numbers that have
special musical meaning. Rather than explain every step of that
meaning off the bat, we can instead look quite quickly at what I am
referring to.
</p>

<div class="org-src-container">

<pre class="src src-clojure">(rand-nth <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords)
</pre>
</div>
</div></li>
<li><a id="orgheadline6"></a>begin voicing chords and printingout<br  /><div class="outline-text-5" id="text-1-1-2-2">
<p>
In order to get more experience with what these sets refer to, it will
help to create a quick bit of code that will help us listen to some
manifestations of these sets.
</p>

<p>
The following function makes it easy to put us quickly in touch with
some arbitrary "realizations" of these sets.
</p>

<div class="org-src-container">

<pre class="src src-clojure"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">might be better to refer to set-type cardinality in the argument here</span>
(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-rand-set</span> [set-type]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (rand-nth set-type)
        voiced-set (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set)
        set-voicing-pair (list set voiced-set)]
    (<span style="color: #F0DFAF; font-weight: bold;">do</span>
      (println set-voicing-pair)
      set-voicing-pair)))
</pre>
</div>


<div class="org-src-container">

<pre class="src src-clojure">(voice-rand-set <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords)
</pre>
</div>
</div></li></ol>
</div>
<div id="outline-container-orgheadline13" class="outline-4">
<h4 id="orgheadline13"><span class="section-number-4">1.1.3</span> begin selecting chords according to probability distr</h4>
<div class="outline-text-4" id="text-1-1-3">
<p>
This section jumps rather peremptorily to the topic of using
probability to make decision about these sets. Consider refiling this
in another section.
</p>
</div>

<ol class="org-ol"><li><a id="orgheadline8"></a>segment set-type space into 4 components<br  /><div class="outline-text-5" id="text-1-1-3-1">
<p>
Tetrachords are, roughly-speaking, a fancy word for collections of
four distinct notes. While four-note chords don't seem especially
unusual or dramatic, there are quite a few different "types" of such
collections. Without going too much into the details, we can form four
groups of these four-note collections in order to facilitate selecting
chords that may have special qualities.
</p>


<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">zero12s</span> (subvec (vec <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords) 0 6))

(<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">dia1</span> (subvec (vec <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords) 7 11))

(<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">tri-heavy</span> (subvec (vec <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords) 11 17))

(<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">whole-tones</span> (subvec (vec <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords) 17  25))
</pre>
</div>


<p>
Once these groups are defined, we can make slections from them in
according to a rough kind of plan. First, however, we should take note
of <i>destructuring</i>, which is a special technique for creating names in
as efficient a manner as possible.
</p>

<p>
In this case, it means that 
</p>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">tetra-probs1</span> [[z x y w]]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [n (rand)]
    (<span style="color: #F0DFAF; font-weight: bold;">cond</span>
      (&gt;= n z) (rand-nth whole-tones)
      (&gt;= n x) (rand-nth tri-heavy)
      (&gt;= n y) (rand-nth dia1)
      (&gt;= n w) (rand-nth zero12s)
      <span style="color: #BFEBBF;">:else</span> (rand-nth <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>hexachords ))))
</pre>
</div>


<div class="org-src-container">

<pre class="src src-clojure">(tetra-probs1 [0.8 0.5 0.2 0.1])
</pre>
</div>
</div></li>

<li><a id="orgheadline9"></a>create logic for random selection according to prob distribution<br  /><div class="outline-text-5" id="text-1-1-3-2">
<p>
If we were not to use destructuring it would like this. Perhaps not a
significant appearing difference&#x2026;
</p>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">tetra-probs2</span> [z x y w]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [n (rand)]
    (<span style="color: #F0DFAF; font-weight: bold;">cond</span>
      (&gt;= n z) (rand-nth whole-tones)
      (&gt;= n x) (rand-nth tri-heavy)
      (&gt;= n y) (rand-nth dia1)
      (&gt;= n w) (rand-nth zero12s)
      <span style="color: #BFEBBF;">:else</span> (rand-nth <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>hexachords ))))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(tetra-probs2 0.8 0.5 0.2 0.1)
</pre>
</div>
</div></li>

<li><a id="orgheadline12"></a>add fully functional transpositions and printout info<br  /><ol class="org-ol"><li><a id="orgheadline10"></a>choose set randomly according to old logic<br  /><div class="outline-text-6" id="text-1-1-3-3-1">
<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-and-transpose-rand-set</span> [set-type tn-level]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (rand-nth set-type)
        voiced-set (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set)
        visible-pairings (map #(list <span style="color: #DFAF8F;">%</span> (mod <span style="color: #DFAF8F;">%</span> 12)) voiced-set)
        transposed-set (map #(+ tn-level <span style="color: #DFAF8F;">%</span>) voiced-set)
        paired-transposed-set (map #(list (mod <span style="color: #DFAF8F;">%</span> 12) (+ tn-level <span style="color: #DFAF8F;">%</span>)) (sort voiced-set))
        set-voicing-group (list <span style="color: #BFEBBF;">:set</span> set
                                <span style="color: #BFEBBF;">:tn-level</span> tn-level
                                <span style="color: #BFEBBF;">:reg</span> visible-pairings
                                <span style="color: #BFEBBF;">:sorted-trans</span> paired-transposed-set)]
    (<span style="color: #F0DFAF; font-weight: bold;">do</span>
      (println set-voicing-group)
      #_<span style="color: #7F9F7F;">set-voicing-group</span> transposed-set)))
</pre>
</div>
<div class="org-src-container">

<pre class="src src-clojure">(voice-and-transpose-rand-set <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords 0 #_<span style="color: #7F9F7F;">(rand-int 12)</span>)
</pre>
</div>
</div></li>

<li><a id="orgheadline11"></a>choose set using new logic w prob. distribution<br  /><div class="outline-text-6" id="text-1-1-3-3-2">
<p>
Different kinds of printing out to the repl are being experimented with
</p>
<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-and-transpose-tetra-probs</span> [tn-level]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (tetra-probs2 0.8 0.5 0.2 0.1)
        voiced-set (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set)
        visible-pairings (map #(list <span style="color: #DFAF8F;">%</span> (mod <span style="color: #DFAF8F;">%</span> 12)) voiced-set)
        transposed-set (map #(+ tn-level <span style="color: #DFAF8F;">%</span>) voiced-set)
        paired-transposed-set (map #(list (mod <span style="color: #DFAF8F;">%</span> 12) (+ tn-level <span style="color: #DFAF8F;">%</span>) (find-note-name <span style="color: #DFAF8F;">%</span>)) (sort voiced-set))
        set-voicing-group (list <span style="color: #BFEBBF;">:set</span> set
                                <span style="color: #BFEBBF;">:tn-level</span> tn-level
                                <span style="color: #BFEBBF;">:reg</span> visible-pairings
                                <span style="color: #BFEBBF;">:sorted-trans</span> paired-transposed-set)]
    (<span style="color: #F0DFAF; font-weight: bold;">do</span>
      (pprint set-voicing-group)
      #_<span style="color: #7F9F7F;">set-voicing-group</span> transposed-set)))
</pre>
</div>


<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-and-transpose-tetra-probs</span> [tn-level]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (tetra-probs2 0.8 0.5 0.2 0.1)
        voiced-set (sort (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set))
        visible-pairings (map #(list <span style="color: #DFAF8F;">%</span> (mod <span style="color: #DFAF8F;">%</span> 12)) voiced-set)
        transposed-set (map #(+ tn-level <span style="color: #DFAF8F;">%</span>) voiced-set)
        paired-transposed-set (map #(list (mod <span style="color: #DFAF8F;">%</span> 12) (+ tn-level <span style="color: #DFAF8F;">%</span>) (find-note-name <span style="color: #DFAF8F;">%</span>)) (sort transposed-set))
        set-voicing-group (list <span style="color: #BFEBBF;">:set</span> set
                                <span style="color: #BFEBBF;">:tn-level</span> tn-level
                                <span style="color: #BFEBBF;">:reg</span> visible-pairings
                                <span style="color: #BFEBBF;">:sorted-trans</span> paired-transposed-set)]
(<span style="color: #F0DFAF; font-weight: bold;">do</span> (println set tn-level)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [mids visible-pairings]
      (println mids))
    (println)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [names paired-transposed-set]
      (cl-format <span style="color: #BFEBBF;">true</span> <span style="color: #CC9393;">"卑泪%"</span> names))
    (println)
    #_<span style="color: #7F9F7F;">set-voicing-group</span> 
    transposed-set)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-and-transpose-tetra-probs</span> [tn-level]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (tetra-probs2 0.8 0.5 0.2 0.1)
        voiced-set (sort (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set))
        visible-pairings (map #(list <span style="color: #DFAF8F;">%</span> (mod <span style="color: #DFAF8F;">%</span> 12)) voiced-set)
        transposed-set (map #(+ tn-level <span style="color: #DFAF8F;">%</span>) voiced-set)
        paired-transposed-set (map #(list (mod <span style="color: #DFAF8F;">%</span> 12) (+ tn-level <span style="color: #DFAF8F;">%</span>) (find-note-name <span style="color: #DFAF8F;">%</span>)) (sort transposed-set))
        set-voicing-group (list <span style="color: #BFEBBF;">:set</span> set
                                <span style="color: #BFEBBF;">:tn-level</span> tn-level
                                <span style="color: #BFEBBF;">:reg</span> visible-pairings
                                <span style="color: #BFEBBF;">:sorted-trans</span> paired-transposed-set)]
(<span style="color: #F0DFAF; font-weight: bold;">do</span> (println set tn-level)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [mids visible-pairings]
      (println mids))
    (println)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [names paired-transposed-set]
      (cl-format <span style="color: #BFEBBF;">true</span> <span style="color: #CC9393;">"卑泪%"</span> names))
    (println)
    #_<span style="color: #7F9F7F;">set-voicing-group</span> 
    transposed-set)))
</pre>
</div>
</div></li></ol></li></ol>
</div>

<div id="outline-container-orgheadline17" class="outline-4">
<h4 id="orgheadline17"><span class="section-number-4">1.1.4</span> choose the set type for dissonances</h4>
<div class="outline-text-4" id="text-1-1-4">
<p>
use play piano as above to play dissonances
 play-piano-chord will appear to want a vector!
see 'testing out the piano' subtree above
</p>
</div>
<ol class="org-ol"><li><a id="orgheadline14"></a>play chords according to selection with old logic<br  /><div class="outline-text-5" id="text-1-1-4-1">
<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">piano-dissonances1</span> [set-type]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [notes (vec (voice-and-transpose-rand-set <span style="color: #7F9F7F;">; voicing</span>
                 set-type <span style="color: #7F9F7F;">;set-class/tetrachords set-type, for instance</span>
                       (rand-int 12)))]
    (play-piano-chord notes)))
</pre>
</div>


<div class="org-src-container">

<pre class="src src-clojure">(piano-dissonances1 <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>pentachords)
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(piano-dissonances1 <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>hexachords)
</pre>
</div>
</div></li>
<li><a id="orgheadline15"></a>play chords selected according to prob distribution; use quieter playing function<br  /><div class="outline-text-5" id="text-1-1-4-2">
<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">piano-dissonances3</span> []
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [notes (vec (voice-and-transpose-tetra-probs  <span style="color: #7F9F7F;">; voicing</span>
                    (rand-int 12)))]
    (play-quieter-piano-chord notes)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(piano-dissonances3)
</pre>
</div>
</div></li>
<li><a id="orgheadline16"></a>borrow random-sample function from clojure 1.7<br  /><div class="outline-text-5" id="text-1-1-4-3">
<p>
Here, the use of <code>filter</code> with a function that returns boolean values
in accordance with a certain probability distribution may take a
little figuring out.
</p>

<p>
The idea with <code>filter</code> is that it will call the function given as its
first argument on each member of the collection passed as its second
argument. Looking at the source for filter, we see that it:
</p>

<blockquote>
<p>
Returns a lazy sequence of the items in coll for which (pred item)
returns true. pred must be free of side-effects.
</p>
</blockquote>

<p>
This means that, for each item in the coll, you have a <code>prob</code> chance
of selecting it.
</p>


<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">random-sample</span>
  <span style="color: #9FC59F;">"Returns items from coll with random probability of prob (0.0 -</span>
<span style="color: #9FC59F;">  1.0).  Returns a transducer when no collection is provided."</span>
  {<span style="color: #BFEBBF;">:added</span> <span style="color: #CC9393;">"1.7"</span>}
  ([prob]
     (filter (<span style="color: #F0DFAF; font-weight: bold;">fn</span> [_] (&lt; (rand) prob))))
  ([prob coll]
     (filter (<span style="color: #F0DFAF; font-weight: bold;">fn</span> [_] (&lt; (rand) prob)) coll)))
</pre>
</div>


<div class="org-src-container">

<pre class="src src-clojure">(random-sample 0.5 '(1 2))
</pre>
</div>
</div></li></ol>
</div>

<div id="outline-container-orgheadline18" class="outline-4">
<h4 id="orgheadline18"><span class="section-number-4">1.1.5</span> tetrachord piano dissonances; hard-coded set-type</h4>
<div class="outline-text-4" id="text-1-1-5">
<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">tetrachord-piano-dissonances2</span> []
   (<span style="color: #F0DFAF; font-weight: bold;">let</span> [notes (voice-and-transpose-rand-set <span style="color: #7F9F7F;">; voicing</span>
                 <span style="color: #7CB8BB;">set-class</span><span style="color: #DCDCCC; background-color: #3F3F3F;">/</span>tetrachords <span style="color: #7F9F7F;">;set-type, for instance</span>
                       (rand-int 12))]
    (play-piano-chord notes)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(tetrachord-piano-dissonances2 )
</pre>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline21" class="outline-3">
<h3 id="orgheadline21"><span class="section-number-3">1.2</span> dealing with timing</h3>
<div class="outline-text-3" id="text-1-2">
<p>
THe following bits of code might best be thought of as ear-training
exercise. If you're into that sort of thing.
</p>
</div>
<div id="outline-container-orgheadline20" class="outline-4">
<h4 id="orgheadline20"><span class="section-number-4">1.2.1</span> making the dissonant piano player play in time</h4>
<div class="outline-text-4" id="text-1-2-1">
<p>
Note, this will be writing out to the repl!!! Why and where? Because
that is how chord-progression-time8 works? Which is defined where?
</p>



<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">metro</span> (metronome 10))

(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">play-piano-dissonances2</span> [nome]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [beat (nome)]
    (at (nome beat) (tetrachord-piano-dissonances2))
    (apply-at (nome (inc beat)) play-piano-dissonances2 nome [])))

(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">play-piano-dissonances3</span> [nome]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [beat (nome)]
    (at (nome beat) (piano-dissonances3))
    (apply-at (nome (inc beat)) play-piano-dissonances3 nome [])))


<span style="color: #5F7F5F;">;</span><span style="color: #7F9F7F;">(play-piano-dissonances2 metro)</span>
(play-piano-dissonances3 metro)
</pre>
</div>
</div>
</div>
</div>
</div>

<div id="outline-container-orgheadline27" class="outline-2">
<h2 id="orgheadline27"><span class="section-number-2">2</span> reflection</h2>
<div class="outline-text-2" id="text-2">
<p>
The next thing to experiment with would be to work with the following
functions to see how much flexibility could be achieved. Right now,
there's a certain amount that is hard-coded in to all of these things
that it would be nice to abstract out, making it easier to create
variation.
</p>
</div>

<div id="outline-container-orgheadline23" class="outline-3">
<h3 id="orgheadline23"><span class="section-number-3">2.1</span> This is the stable code for this page.</h3>
<div class="outline-text-3" id="text-2-1">
<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">def</span> <span style="color: #DFAF8F;">metro</span> (metronome 10))

(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-and-transpose-tetra-probs</span> [tn-level]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (tetra-probs2 0.8 0.5 0.2 0.1)
        voiced-set (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set)
        visible-pairings (map #(list <span style="color: #DFAF8F;">%</span> (mod <span style="color: #DFAF8F;">%</span> 12)) voiced-set)
        transposed-set (map #(+ tn-level <span style="color: #DFAF8F;">%</span>) voiced-set)
        paired-transposed-set (map #(list (mod <span style="color: #DFAF8F;">%</span> 12)
                                          (+ tn-level <span style="color: #DFAF8F;">%</span>)
                                          (find-note-name <span style="color: #DFAF8F;">%</span>))
                                   (sort voiced-set))
        set-voicing-group (list <span style="color: #BFEBBF;">:set</span> set
                                <span style="color: #BFEBBF;">:tn-level</span> tn-level
                                <span style="color: #BFEBBF;">:reg</span> visible-pairings
                                <span style="color: #BFEBBF;">:sorted-trans</span> paired-transposed-set)]
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [info set-voicing-group]
      (pprint info))
    (println)
            #_<span style="color: #7F9F7F;">set-voicing-group</span> 
            transposed-set))

(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">piano-dissonances3</span> []
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [notes (vec (voice-and-transpose-tetra-probs  <span style="color: #7F9F7F;">; voicing</span>
                    (rand-int 12)))]
    (play-quieter-piano-chord notes)))


(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">play-piano-dissonances3</span> [nome]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [beat (nome)]
    (at (nome beat) (piano-dissonances3))
    (apply-at (nome (inc beat)) play-piano-dissonances3 nome [])))

(play-piano-dissonances3 metro)
</pre>
</div>
</div>
</div>

<div id="outline-container-orgheadline24" class="outline-3">
<h3 id="orgheadline24"><span class="section-number-3">2.2</span> experiment with different printing options</h3>
<div class="outline-text-3" id="text-2-2">
<p>
#+COMMENT works
</p>
<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-and-transpose-tetra-probs</span> [tn-level]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (tetra-probs2 0.8 0.5 0.2 0.1)
        voiced-set (sort (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set))
        visible-pairings (map #(list <span style="color: #DFAF8F;">%</span> (mod <span style="color: #DFAF8F;">%</span> 12)) voiced-set)
        transposed-set (map #(+ tn-level <span style="color: #DFAF8F;">%</span>) voiced-set)
        paired-transposed-set (map #(list (mod <span style="color: #DFAF8F;">%</span> 12) (+ tn-level <span style="color: #DFAF8F;">%</span>) (find-note-name <span style="color: #DFAF8F;">%</span>)) (sort transposed-set))
        set-voicing-group (list <span style="color: #BFEBBF;">:set</span> set
                                <span style="color: #BFEBBF;">:tn-level</span> tn-level
                                <span style="color: #BFEBBF;">:reg</span> visible-pairings
                                <span style="color: #BFEBBF;">:sorted-trans</span> paired-transposed-set)]
(<span style="color: #F0DFAF; font-weight: bold;">do</span> (println set tn-level)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [mids visible-pairings]
      (println mids))
    (println)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [names paired-transposed-set]
      (cl-format <span style="color: #BFEBBF;">true</span> <span style="color: #CC9393;">"卑泪%"</span> names))
    (println)
    #_<span style="color: #7F9F7F;">set-voicing-group</span> 
    transposed-set)))
</pre>
</div>

<div class="org-src-container">

<pre class="src src-clojure">(<span style="color: #F0DFAF; font-weight: bold;">defn</span> <span style="color: #93E0E3;">voice-and-transpose-tetra-probs</span> [tn-level]
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> [set (tetra-probs2 0.8 0.5 0.2 0.1)
        voiced-set (sort (map #(+ (rand-nth [36 48 60 72]) <span style="color: #DFAF8F;">%</span>) set))
        visible-pairings (map #(list <span style="color: #DFAF8F;">%</span> (mod <span style="color: #DFAF8F;">%</span> 12)) voiced-set)
        transposed-set (map #(+ tn-level <span style="color: #DFAF8F;">%</span>) voiced-set)
        paired-transposed-set (map #(list (mod <span style="color: #DFAF8F;">%</span> 12) (+ tn-level <span style="color: #DFAF8F;">%</span>) (find-note-name <span style="color: #DFAF8F;">%</span>)) (sort transposed-set))
        set-voicing-group (list <span style="color: #BFEBBF;">:set</span> set
                                <span style="color: #BFEBBF;">:tn-level</span> tn-level
                                <span style="color: #BFEBBF;">:reg</span> visible-pairings
                                <span style="color: #BFEBBF;">:sorted-trans</span> paired-transposed-set)]
(<span style="color: #F0DFAF; font-weight: bold;">do</span> (println set tn-level)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [mids visible-pairings]
      (println mids))
    (println)
    (<span style="color: #F0DFAF; font-weight: bold;">doseq</span> [names paired-transposed-set]
      (cl-format <span style="color: #BFEBBF;">true</span> <span style="color: #CC9393;">"怖狺ア集箴犷钺礤螬痱轭綮瞟＿俭疳篝戾舰泔祜蚝７乒品苹⒕箦舡鲲殂轭绛珧秕鸺箴犷趄犷箴矬邃箦舂┅集痱寰集溟鼍集溟鼍集溟鼍间轹殇舰秕綮轭瀛泔铘衢铄颦矧玷遽潇轭宀盯沆狍蠼秕綮轭瀛尝艰殇舰矧玷遽潇轭宀盯炯箴犷沆狍蠼Ⅲ邈糸镱铛礅弪尝静臣箴犷轫痱秭屙孱趔犷蝈驷泗矧轭缂璩间轹沆狍蠼秕綮轭瀛翦舡尝殇舰翦舡箔尝拣项镦翳骈蝮翳轭珞翳狒黠蹯忮铋沐黠蹯忮麸徙栝弼遽簌汨犷珏轭翦趱蝈澡轶轶沆矬屐蝈灬翦麸聃弩糸镱镦糸黹铉麒殂翦汨铋汜祆泔蹯忮翳彘秣翳轭绠集鹁拣澡雉桢忾翳轭黠蹯忮麸栳鲥盹蝈箫痂轶糸汜翦泔铘蝻秭弪汨矧箦戾泗轱町澡轶徙趱犰禊孱翎殪祜艉集鹁减沆狍蠼矧绛蹯⒕检榫汨镩沐镦箦艏扉检榫汨镩沐镦趄犷箴矬轸轱戾鲥旒扉检榫汨镩沐镦鲲殂轭缂扉集蹯拣澡秕玷翳轶箦屙扉脲铒磲铢翳轭珞翳驷泗轶翳狒犷玳鲥汨镩沐骘镱镦翳翳蝈泔蹯徭驽泗麒狒汨镩沐麇黠蹯麽铘麸磲脲骝镯翳雉桢赭锂澡狒轶翳弩翳蝈翳轭珞狎栝玷禊轭翦蜾屦孱溴铘集鹁拣崎钺祆盹篝疱镳戾扉脲忾镦礤祜澌鏖翳翳彘汨矧痱镧蝈篌轱铙怩殪溟铉轭铒糸镱镦麸扉铄黠蹯箫螋镦驷祆秕镦翳轶篚弩镦糸黹铉犷鲲殂瀛戾徜轭狍徕秭瀹集鹁拣澡轶鏖祆戾徜躞盹蝈痱镳弪禊轭麸翳铄趱麸蜷犰麒殂鏖祆忮玳麸戾徜躞盹蝈溴屦禊轭麸翳徕秭痫轭趔集鹁拣澡聃弩糸镱镦栾熹轭镱麸翳弩珏铄蜥翦汨矧潴鏖祆狎轶犷戾徜躞骝镯翳铄趱麸蜷犰集鹁拣垅蹰熹轭绛鲲殂瀛戾徜轭绛孱玳铄莰坚栩彐舰梏麴蠛玳翳踱泔懑汩沐蝻觑铄蟑痫篝麸钺飙秭弪麸铄忪镡磲篝弪篁惘痫篝唪镱犰唢鲥螋镱瀵矧邕骈戾蟑怩殪洵鲲殂瀛戾徜轭绛孱玳铄矧纰捐趑痼函玳翳踱泔懑汩沐蝻觑铄蟑痫篝麸钺飙秭弪麸铄忪镡磲篝弪篁惘痫篝唪镱犰唢鲥螋镱瀵矧邕骈戾蟑怩殪洵鲲殂瀛戾徜轭绛孱玳铄矧缂峋集鹁拣轭麸翳骈钺镱镦翳轶箦蜷弩垌镤屐轭绛眭箝汜飙糸礤莰坚栩彐舰梏麴蠛玳翳踱泔懑汩沐蝻觑铄蟑痫篝麸钺飙秭弪麸铄忪镡磲篝弪篁惘痫篝唪镱犰唢鲥螋镱瀵矧邕骈戾蟑盹溴扉铉眭箝汜飙糸礤矧纰捐趑痼函玳翳踱泔懑汩沐蝻觑铄蟑痫篝麸钺飙秭弪麸铄忪镡磲篝弪篁惘痫篝唪镱犰唢鲥螋镱瀵矧邕骈戾蟑盹溴扉铉眭箝汜飙糸礤矧缂峋集鹁集溟鼍间轹殇舰秕綮轭瀛泔铘衢铄颦矧玷遽潇轭宀耽沆狍蠼秕綮轭瀛储艰殇舰矧玷遽潇轭宀耽炯箴犷沆狍蠼Ⅲ邈糸镱铛礅弪储静钞奔箴犷徜溴钿蹴集璐间轹沆狍蠼秕綮轭瀛翦舡储殇舰翦舡箔抄雹拣澡弪狎瀣镦泔躜箦狒戾狍驽雉桢翳轭珞麸泔铙殇弪翳狒麇蝈戾骠秕徕秭瀹项镦翳栳蜾弩麸秭弪祜镫轶麒狒奸倔秕钿集榫秕徙趱犰禊躞濉义禊轭镱翳筢眇戾洵痖犷磲脲顼镤箦铙骘翳盹礤铘狍轸犰祜黧躞麸泔钽孱趄狒镱痱镡戾眢铒蝈灬翦麸簌铘桢箝蟋麒殂怛轭珞鏖翳轸麒镬雉桢箪鬻镦雉桢翳轭珞麸翳轭徕秕轸集鹁集溟鼍集溟鼍集溟鼍集溟鼍集溟鼍间轹殇舰痫篝犴忪澧沆狍蠼Ⅲ翎趱螈拣沆狍蠼⑨豸栾颌玖豸栾蚝饧鹁拣沆狍蠼溽翦⒕抿遽翦浜舶倍辈安乞钡翰布鹁拣沆狍蠼Ⅵ犰殇狒轱睥炯栩彐舰梏麴函鲠扉溽麸虍鞒矧绡汨邈肟躜榻蝈驽蝈颌局犰殇狒寮峋集鹁集溟鼍集怙澌集梏盱